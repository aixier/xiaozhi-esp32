# 小智 AI 交互设计规范 V2

> 更新时间: 2024-12-20
> 设计师: UX Team
> 目标设备: zhengchen_eye (圆形 LCD 240x240)

## 1. 设计理念

### 1.1 核心原则

| 原则 | 描述 |
|------|------|
| **情感优先** | 表情是设备的"灵魂"，始终保持可见和生动 |
| **信息分层** | 状态 > 表情 > 文本，避免信息过载 |
| **即时反馈** | 每个用户操作都有视觉响应 |
| **情感连续** | 表情切换应有情感逻辑，不突兀 |

### 1.2 用户心智模型

```
用户期望：一个有情感的 AI 伙伴
         ↓
看到表情 → 感受情绪 → 建立连接
         ↓
听到声音 → 理解内容 → 完成交互
```

## 2. 交互触发与反馈矩阵

### 2.1 触发方式对比

| 触发方式 | 用户意图 | 设备反馈 | 表情变化 |
|----------|----------|----------|----------|
| **Boot 按钮** | 主动发起对话 | 立即响应 | neutral → thinking |
| **触摸头部** | 寻求情感互动 | 温暖回应 | neutral → love |
| **触摸下巴** | 亲密接触 | 开心反应 | neutral → happy |
| **唤醒词** | 远程唤醒 | 警觉响应 | sleepy → neutral |

### 2.2 完整交互状态机

```
                                    ┌─────────────────┐
                                    │                 │
            ┌───────────────────────│    睡眠模式     │
            │                       │  (屏幕暗/息屏)  │
            │                       └────────┬────────┘
            │                                │
            │ 30秒无操作                      │ 任意触发
            │                                ▼
┌───────────┴───────────┐           ┌─────────────────┐
│                       │◄──────────│                 │
│       空闲模式        │  对话结束  │    唤醒过渡     │
│   表情: neutral       │           │  表情: neutral  │
│   状态: "待机"        │           │  时长: 0.5s     │
└───────────┬───────────┘           └─────────────────┘
            │
            │ 按钮/触摸/唤醒词
            ▼
┌─────────────────────────────────────────────────────┐
│                     连接模式                         │
│            表情: thinking (闪烁动画)                 │
│            状态: "连接中..."                         │
│            时长: 1-3秒                               │
└───────────────────────┬─────────────────────────────┘
                        │
            ┌───────────┴───────────┐
            │ 连接成功              │ 连接失败
            ▼                       ▼
┌─────────────────────┐   ┌─────────────────────┐
│                     │   │                     │
│      聆听模式       │   │      错误模式       │
│  表情: neutral      │   │  表情: sad/confused │
│  状态: "聆听中"     │   │  状态: "连接失败"   │
│  动画: 脉冲呼吸     │   │  时长: 3秒后返回    │
└──────────┬──────────┘   └─────────────────────┘
           │
           │ 检测到语音
           ▼
┌─────────────────────┐
│                     │
│      处理模式       │
│  表情: thinking     │
│  状态: "思考中..."  │
│  动画: 旋转/闪烁    │
└──────────┬──────────┘
           │
           │ 收到回复
           ▼
┌─────────────────────────────────────────────────────┐
│                      回复模式                        │
│   表情: 根据内容动态变化 (happy/sad/love/...)        │
│   状态: "说话中"                                     │
│   文本: 显示回复内容 (可选)                          │
└─────────────────────────────────────────────────────┘
```

## 3. 表情情感映射

### 3.1 情感类别

```
           积极情感                    中性情感                    消极情感
    ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
    │ happy           │        │ neutral         │        │ sad             │
    │ laughing        │        │ thinking        │        │ crying          │
    │ love            │        │ confused        │        │ angry           │
    │ winking         │        │ sleepy          │        │                 │
    │ cool            │        │                 │        │                 │
    └─────────────────┘        └─────────────────┘        └─────────────────┘
```

### 3.2 情感转换规则

**原则：情感过渡应自然，避免极端跳跃**

| 当前表情 | 允许直接转换 | 需要过渡的转换 |
|----------|--------------|----------------|
| neutral | 任意 | - |
| happy | neutral, love, winking | sad (需经过 neutral) |
| sad | neutral, crying | happy (需经过 neutral) |
| angry | neutral, sad | happy (需经过 neutral) |
| thinking | neutral, happy, confused | - |

### 3.3 情感过渡实现

```cpp
// 建议的过渡逻辑
void TransitionEmotion(const char* from, const char* to) {
    if (NeedsTransition(from, to)) {
        SetEmotion("neutral");
        vTaskDelay(pdMS_TO_TICKS(200));  // 短暂过渡
    }
    SetEmotion(to);
}
```

## 4. 屏幕信息层次

### 4.1 视觉层级

```
┌───────────────────────────────────────────┐
│ ┌─────────────────────────────────────┐   │
│ │  Layer 4: 通知层 (最高优先级)        │   │
│ │  - Alert 弹窗                        │   │
│ │  - 系统消息                          │   │
│ └─────────────────────────────────────┘   │
│ ┌─────────────────────────────────────┐   │
│ │  Layer 3: 状态栏 (始终可见)          │   │
│ │  - 电池 | 时间 | 网络                │   │
│ └─────────────────────────────────────┘   │
│ ┌─────────────────────────────────────┐   │
│ │  Layer 2: 文本层 (条件显示)          │   │
│ │  - 对话气泡                          │   │
│ │  - 状态提示文字                      │   │
│ └─────────────────────────────────────┘   │
│ ┌─────────────────────────────────────┐   │
│ │  Layer 1: 表情层 (基础层)            │   │
│ │  - GIF 动画                          │   │
│ │  - 始终存在，透明度可变              │   │
│ └─────────────────────────────────────┘   │
└───────────────────────────────────────────┘
```

### 4.2 显示模式

| 模式 | Layer 1 (表情) | Layer 2 (文本) | Layer 3 (状态栏) |
|------|----------------|----------------|------------------|
| **空闲** | 100% 不透明 | 隐藏 | 简化显示 |
| **对话** | 30% 透明 | 显示气泡 | 完整显示 |
| **表情强调** | 100% 不透明 | 暂时隐藏 | 简化显示 |
| **错误** | 100% (sad/angry) | 显示错误信息 | 完整显示 |

## 5. 触摸交互特殊设计

### 5.1 触摸区域与情感反馈

zhengchen_eye 支持多个触摸区域，每个区域应有独特的情感反馈：

```
        ┌─────────┐
       ╱           ╲
      │   头部触摸   │  → 表情: love + "被摸头啦~"
      │  (舒适感)    │
      ├─────────────┤
      │             │
      │    脸部     │  → 表情: happy
      │             │
      ├─────────────┤
      │   下巴触摸   │  → 表情: winking + "好舒服~"
      │  (亲密感)    │
       ╲           ╱
        └─────────┘
```

### 5.2 触摸反馈时序

```
触摸开始
    ↓ 立即 (< 50ms)
表情变化 (love/happy)
    ↓ 同时
播放反馈音效 (可选)
    ↓ 200ms 后
发送 WakeWordInvoke (带自定义提示语)
    ↓
进入对话流程
    ↓ 服务器回复
播放情感化 TTS
```

### 5.3 触摸提示语设计

| 触摸位置 | 提示语 | 期望 AI 回复风格 |
|----------|--------|------------------|
| 头部 | "(正在抚摸你的头，请提供情绪价值)" | 撒娇、享受、感谢 |
| 下巴 | "(正在抚摸你的下巴，请提供情绪价值)" | 开心、亲密、调皮 |
| 左脸 | "(正在摸你的左脸，请提供情绪价值)" | 害羞、可爱 |
| 右脸 | "(正在摸你的右脸，请提供情绪价值)" | 满足、幸福 |

## 6. 音视频同步设计

### 6.1 同步原则

| 事件 | 视觉反馈 | 音频反馈 | 时序 |
|------|----------|----------|------|
| 按钮按下 | 表情闪烁 | "叮" 提示音 | 同时 |
| 开始聆听 | 表情脉冲动画 | 无 | - |
| 语音识别成功 | 表情→thinking | 无 | 立即 |
| TTS 开始 | 表情→服务器指定 | TTS 播放 | 同时开始 |
| TTS 结束 | 表情→neutral | 无 | 延迟 500ms |

### 6.2 TTS 表情同步

```
TTS 时间轴:
┌────────────────────────────────────────────────┐
│ "你好啊！" │ "今天天气真好" │ "要不要出去玩？" │
└────────────────────────────────────────────────┘
     ↓              ↓                ↓
表情同步:
┌────────────────────────────────────────────────┐
│   happy   │    neutral    │     winking        │
└────────────────────────────────────────────────┘
```

**建议**: 服务器在 TTS 分段时发送对应的 emotion 消息。

## 7. 错误状态处理

### 7.1 错误类型与表情

| 错误类型 | 表情 | 状态文字 | 恢复动作 |
|----------|------|----------|----------|
| 网络连接失败 | sad | "网络不通" | 自动重试 3 次 |
| 服务器超时 | confused | "服务器繁忙" | 提示用户重试 |
| 语音识别失败 | confused | "没听清楚" | 提示重新说 |
| 系统错误 | angry | "出错了" | 显示错误码 |
| 电量不足 | sleepy | "我困了" | 提示充电 |

### 7.2 错误恢复动画

```
错误发生
    ↓
表情: sad/confused (闪烁 2 次)
    ↓ 2 秒后
表情: neutral (平滑过渡)
    ↓
状态: "待机"
```

## 8. 省电模式设计

### 8.1 省电状态转换

```
正常模式 ──30秒无操作──▶ 屏幕变暗 (50% 亮度)
                              │
                         30秒无操作
                              ▼
                        睡眠模式 (屏幕关闭)
                        表情: sleepy (关闭前最后显示)
                              │
                         任意触发
                              ▼
                        唤醒动画 (0.5秒)
                        表情: sleepy → neutral
```

### 8.2 睡眠/唤醒动画

| 动作 | 时长 | 动画效果 |
|------|------|----------|
| 进入睡眠 | 1秒 | 亮度渐暗 + sleepy 表情 |
| 唤醒 | 0.5秒 | 亮度渐亮 + neutral 表情 |

## 9. 开发任务清单 (更新)

### Phase 1: 基础表情系统 (P0)

- [ ] **Task 1.1**: 统一 SetupUI，确保 gif_label_ 在所有模式下可用
- [ ] **Task 1.2**: 实现 SetEmotionOpacity() 透明度控制
- [ ] **Task 1.3**: 实现 DisplayMode 切换 (Idle/Chat/EmotionFocus)

### Phase 2: 情感过渡 (P1)

- [ ] **Task 2.1**: 实现情感过渡逻辑 TransitionEmotion()
- [ ] **Task 2.2**: 添加表情切换动画 (淡入淡出)
- [ ] **Task 2.3**: 表情强调定时器 (2秒自动恢复)

### Phase 3: 触摸交互增强 (P1)

- [ ] **Task 3.1**: 触摸区域表情映射配置化
- [ ] **Task 3.2**: 触摸反馈音效
- [ ] **Task 3.3**: 触摸时的即时表情变化

### Phase 4: 音视频同步 (P2)

- [ ] **Task 4.1**: TTS 播放时表情同步
- [ ] **Task 4.2**: 服务器分段发送 emotion
- [ ] **Task 4.3**: 播放结束后的表情恢复延迟

### Phase 5: 错误与省电 (P2)

- [ ] **Task 5.1**: 错误状态表情映射
- [ ] **Task 5.2**: 错误恢复动画
- [ ] **Task 5.3**: 睡眠/唤醒动画

## 10. 验收标准

| 场景 | 验收标准 |
|------|----------|
| 按钮触发 | 按下后 < 100ms 表情变化 |
| 触摸触发 | 触摸后立即显示对应情感表情 |
| 对话模式 | 表情透明度 30%，气泡清晰可见 |
| 表情强调 | 全屏显示 2 秒后平滑恢复 |
| 情感过渡 | happy → sad 经过 neutral 过渡 |
| 错误处理 | 错误表情闪烁 2 次后恢复 |
| 省电模式 | 30秒无操作进入睡眠 |

## 11. 参考资源

| 资源 | 链接 |
|------|------|
| 表情系统技术文档 | [EMOTION_SYSTEM.md](./EMOTION_SYSTEM.md) |
| 设备交互逻辑 | [DEVICE_INTERACTION.md](./DEVICE_INTERACTION.md) |
| 显示技术规范 | [DISPLAY_TECHNICAL.md](./DISPLAY_TECHNICAL.md) |
| 音频数据流 | [AUDIO_DATA_FLOW.md](./AUDIO_DATA_FLOW.md) |

---

**文档版本**: 2.0
**最后更新**: 2024-12-20
**维护者**: UX Team
